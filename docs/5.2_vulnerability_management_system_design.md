# 漏洞管理系統設計 (基於 ETSI EN 303 645 5.2)

這份文件根據 `ETSI EN 303 645` 標準中 `5.2 Implement a means to manage reports of vulnerabilities` 的規範，設計一個合適的 Python 模組名稱和一套系統架構。

## Python 模組檔名設計

根據 Python 的命名慣例 (PEP 8)，模組名稱應該簡短、全小寫，並在可能的情況下避免使用特殊符號。

**建議檔名：** `vulnerability_manager.py`

**備選方案：**
*   `cvd_handler.py` (CVD: Coordinated Vulnerability Disclosure)
*   `security_reporter.py`

`vulnerability_manager.py` 是最直觀且涵蓋範圍最廣的名稱，它清晰地表明了這個模組的職責是管理漏洞。

---

## 系統設計架構

為了滿足 5.2 章節的所有 `shall` 和 `should` 要求，我們需要一個結合了公開資訊、內部追蹤與主動監控的系統。以下是一個分層的系統設計架構。

### 總體架構圖

```
+---------------------------------------------------------------------------------+
|                                     外部介面 (External Interfaces)              |
+---------------------------------------------------------------------------------+
|                                                                                 |
|  [公開網站/API] (/security)                                                     |
|   - 漏洞揭露政策 (VDP) (對應 5.2-1)                                             |
|   - 漏洞提報表單/聯絡方式 (對應 5.2-1)                                          |
|   - 安全公告 (Security Advisories)                                              |
|                                                                                 |
+---------------------------------------------------------------------------------+
       |                                      ^
       | (1. 研究員提報漏洞)                  | (5. 發布安全公告)
       v                                      |
+---------------------------------------------------------------------------------+
|                                     核心應用層 (Core Application)               |
|                                 (vulnerability_manager.py)                      |
+---------------------------------------------------------------------------------+
|                                                                                 |
|  [漏洞追蹤系統 (Vulnerability Tracking System)]                                 |
|   - 接收與解析報告                                                              |
|   - 案件生命週期管理 (新建, 分析中, 已修復, 已關閉) (對應 5.2-2)                |
|   - 自動化通知 (Acknowledgement, Status Updates) (對應 5.2-1)                   |
|   - 嚴重性評估 (Severity Assessment)                                            |
|   - 指派給對應的工程團隊                                                        |
|   - 產生安全公告草稿 (e.g., CSAF 格式)                                          |
|                                                                                 |
+---------------------------------------------------------------------------------+
       ^                                      |
       | (3. 發現已知漏洞)                    | (4. 工程團隊更新狀態)
       |                                      v
+---------------------------------------------------------------------------------+
|                                   後端與整合層 (Backend & Integration)          |
+---------------------------------------------------------------------------------+
|                                                                                 |
|  [主動監控模組 (Proactive Monitoring)] (對應 5.2-3)                             |
|   - SBOM 管理器 (Software Bill of Materials)                                    |
|   - 連接外部漏洞資料庫 (NVD, GitHub Advisories...)                               |
|   - 分析 SBOM 與漏洞資料庫，自動建立案件                                        |
|                                                                                 |
|  [資料庫 (Database)]                                                            |
|   - 儲存漏洞報告、溝通紀錄、SBOM、產品資訊                                      |
|                                                                                 |
|  [整合介面 (Integrations)]                                                      |
|   - Email 服務 (用於通知)                                                       |
|   - 專案管理工具 (Jira, etc.)                                                   |
|                                                                                 |
+---------------------------------------------------------------------------------+
```

### 各層詳細說明

#### 1. 外部介面 (External Interfaces)

這是系統的公開門面，主要服務於安全研究員和一般使用者。

*   **職責**:
    *   **公開漏洞揭露政策 (Vulnerability Disclosure Policy, VDP)**: 在公司網站上（例如 `example.com/security`）提供一個清晰的頁面，內容包含：
        *   報告問題的聯絡方式（如 `security@example.com` 或一個網頁表單）。
        *   收到報告後進行初步確認的時程表（例如：我們會在 2 個工作天內確認收到您的報告）。
        *   提供後續狀態更新的時程表（例如：我們將至少每 30 天向您更新處理進度）。
    *   **漏洞提報管道**: 提供一個結構化的網頁表單或一個專門的電子郵件地址，讓研究員可以安全地提交他們的發現。
*   **對應條款**: `5.2-1` (shall make publicly available a vulnerability disclosure policy)。

#### 2. 核心應用層 (Core Application)

這是 `vulnerability_manager.py` 模組發揮主要作用的地方。它是一個漏洞追蹤和管理的核心邏輯。

*   **職責**:
    *   **接收與處理**: 從外部介面（如 Email 或表單提交）接收漏洞報告，解析其內容並在資料庫中創建一個新的案件 (ticket)。
    *   **自動化溝通**:
        *   一旦案件創建，立即自動發送一封確認信給報告者，滿足 `5.2-1` 中「初步確認的時程表」的要求。
        *   設定計時器或排程任務，如果案件在一定時間內（如 30 天）沒有狀態更新，就自動提醒內部處理人員並可選擇性地發送狀態更新給報告者。
    *   **生命週期管理**: 實現一個狀態機來管理漏洞的生命週期：`New` -> `Triaged` -> `In Progress` -> `Resolved` -> `Closed`。這有助於確保漏洞被「及時處理」。
    *   **嚴重性評估**: 提供工具或欄位讓安全團隊可以評估漏洞的嚴重性（例如使用 CVSS 分數），這有助於排定修復的優先級。
    *   **公告生成**: 當漏洞被修復後，系統應能協助生成安全公告（Security Advisory），最好能支援如 CSAF (Common Security Advisories Framework) 的標準格式。
*   **對應條款**: `5.2-1`, `5.2-2` (acted upon in a timely manner)。

#### 3. 後端與整合層 (Backend & Integration)

這一層負責資料儲存、主動監控和與其他系統的整合。

*   **職責**:
    *   **主動監控 (Proactive Monitoring)**:
        *   **SBOM 管理**: 維護一份所有產品的軟體物料清單 (SBOM)。這可以是系統的一個功能，讓開發團隊在建構 (build) 過程中上傳 SBOM。
        *   **漏洞掃描**: 定期（例如每天）從公開的漏洞資料庫（如 NVD, GitHub Advisory Database）拉取最新的漏洞資訊。
        *   **自動分析**: 將最新的漏洞資訊與儲存的 SBOM 進行比對。如果發現產品中使用的某個元件有新的已知漏洞，系統應能自動在「核心應用層」創建一個內部案件，指派給對應的產品團隊。
    *   **資料庫**: 使用關聯式資料庫 (如 PostgreSQL) 或 NoSQL 資料庫來持久化儲存所有漏洞報告、與報告者的溝通紀錄、SBOM 清單、產品資訊等。
    *   **整合**:
        *   與 Email 服務 (SendGrid, AWS SES) 整合，用於發送所有通知郵件。
        *   與內部專案管理工具 (Jira, GitLab Issues) 整合，可以將漏洞案件同步到開發團隊的工作流程中。
*   **對應條款**: `5.2-3` (continuously monitor, identify and rectify)。

### 工作流程範例 (End-to-End Flow)

1.  **(外部提報)** 一位安全研究員在 `example.com/security` 頁面找到了漏洞提報表單。
2.  他填寫了受影響的產品、漏洞細節和概念驗證 (PoC) 並提交。
3.  **(核心應用)** `vulnerability_manager.py` 接收到表單提交，在資料庫中創建一個新案件，狀態為 `New`，並立即向研究員的信箱發送一封「已收到報告」的確認信。
4.  **(內部處理)** 公司的安全團隊收到新案件通知，進行初步分析 (Triage)，確認漏洞有效性，評估其嚴重性為 "High"，並將狀態改為 `Triaged`，同時指派給 "Smart-Lock-Firmware" 開發團隊。
5.  **(整合)** 案件被同步到開發團隊的 Jira 看板上。
6.  **(及時處理)** 開發團隊開始修復漏洞，並定期在 Jira 中更新進度，這些進度可以被同步回 `vulnerability_manager` 系統。系統會根據 `5.2-1` 的策略，定期向研究員發送進度更新郵件。
7.  **(主動發現)** 與此同時，`vulnerability_manager` 的主動監控模組發現 "Smart-Lock-Firmware" 使用的 `openssl v1.1.1g` 有一個新發布的 CVE。系統自動創建一個新案件，並指派給開發團隊。
8.  **(解決與發布)** 開發團隊完成了兩個漏洞的修復，並發布了新的韌體版本。他們在系統中將案件狀態更新為 `Resolved`。
9.  **(公告)** 安全團隊審核修復方案，並使用 `vulnerability_manager` 的公告生成功能，創建一份安全公告，感謝研究員的貢獻，並說明受影響版本和修復版本。公告被發布到 `example.com/security/advisories` 頁面。案件最終狀態變為 `Closed`。