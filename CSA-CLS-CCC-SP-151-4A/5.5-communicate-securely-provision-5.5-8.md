## 5.5 – 安全通訊 (COMMUNICATE SECURELY)

### 條款 5.5-8 (Provision 5.5-8)

製造商必須針對與設備相關的關鍵安全參數，遵循安全管理流程 (secure management processes)。

#### 最低要求 (Minimum Requirements)

* 必須針對與下列設備功能相關的所有金鑰 (keys)，建立安全金鑰管理流程：
    * 安全通訊
    * 安全韌體更新
    * 敏感數據與安全參數的加密
* 安全金鑰管理流程必須涵蓋下列階段：
    * **金鑰產生 (Key generation)**
    * **金鑰配置 (Key provisioning)**
    * **金鑰使用 (Key usage)**
    * **金鑰儲存 (Key storage)**
    * **金鑰撤銷 (Key revocation)**
    * **金鑰銷毀 (Key destruction)**

#### 建議 (Recommendations)

* 可使用**生命週期圖表/表格 (lifecycle diagram/table)** 來提供所實作的安全金鑰管理流程之更佳視覺呈現。

#### 佐證證據 (Supporting Evidence)

* 開發商應提供證據（例如：生命週期圖表/表格等），顯示針對與上述設備功能相關的所有金鑰，皆具備安全金鑰管理流程。
* 針對每個安全金鑰管理流程的詳細說明如下：
    * **金鑰產生**：開發商應描述金鑰對 (key-pair) 產生的過程，並說明使用的密碼學金鑰產生函式庫或工具（例如：HSM）。
    * **金鑰配置**：開發商應解釋私鑰是如何配置到韌體簽署伺服器，或在韌體簽署過程中使用。
    * **金鑰使用**：開發商應描述金鑰如何被使用，以及如何控制對金鑰的存取。
    * **金鑰儲存**：開發商應詳述私鑰的安全儲存方式（例如：使用 HSM、Android keystore 等）。
    * **金鑰撤銷**：開發商應描述當金鑰在既定的密碼週期 (cryptoperiod) 結束前需要停止操作使用時的處理流程。
    * **金鑰銷毀**：開發商應提供細節，說明當金鑰不再使用時，如何安全地抹除金鑰，使其無法透過實體或電子手段復原。

#### 評估 (Assessment)

* 評估人員將檢查證據，考量金鑰的產生、配置、儲存、使用與銷毀，以判斷開發商對安全金鑰管理流程的描述是否全面。

---

### 開發者深度導讀 (針對 Gateway / App / Cloud 開發商)

#### 本章節核心要求與意涵

本條款是關於**「金鑰生命週期管理 (Key Lifecycle Management, KLM)」**的總體檢。許多團隊只關注「我有加密」，卻忽略了「鑰匙從哪來？」和「鑰匙不用了去哪？」

1.  **全生命週期的覆蓋**：
    * 審查重點不僅是有沒有金鑰，而是這把金鑰的「一生」。從它在 HSM 被亂數生成 (Birth)，注入設備 (Provisioning)，日常加密 (Usage)，到最後設備報廢或金鑰洩漏時的銷毀/撤銷 (Death)。
2.  **撤銷機制 (Revocation) 是最大難點**：
    * **情境**：如果您的 Firmware Signing Key 被駭客偷走了，您有辦法廢除這把鑰匙嗎？
    * **合規要求**：如果設備沒有設計 Key Rotation (金鑰輪替) 機制或檢查 CRL (憑證撤銷清單)/OCSP 的能力，這項通常會失敗。您必須證明「當災難發生時，我有備案」。
3.  **雲端與地端並重**：這條款同時適用於 **設備端金鑰** (如 Client Cert) 與 **後端金鑰** (如 Firmware Signing Key, Cloud Root Key)。

#### 具體落地實現方案建議

* **文件化策略 (Documentation Strategy)**：
    * **繪製 KLM 圖表**：這是最容易過關的方式。畫一張流程圖，橫軸是時間（生命週期），縱軸是金鑰狀態。
        * [產生] -> [儲存] -> [配置] -> [使用] -> [撤銷/輪替] -> [銷毀]
        * 在每個方塊中標註使用的技術（例如：Generate via AWS KMS, Store in ATECC608A）。

* **技術實作建議**：
    * **金鑰產生**：
        * **Cloud 端**：使用 AWS KMS / Google Cloud KMS 或 CloudHSM。絕對不要在開發者的筆電上用 OpenSSL 生成 Production Key。
        * **Device 端**：使用 MCU 內建的 TRNG (True Random Number Generator)。
    * **金鑰銷毀**：
        * **Factory Reset 邏輯**：當使用者執行恢復原廠設定時，必須呼叫 Secure Element 的 `Wipe` 指令，或對儲存金鑰的 Flash Sector 進行多次複寫 (Overwriting) 以防止資料復原。

* **證據收集策略**：
    * **KMS 截圖**：截取雲端 Key Management Service 的設定畫面，證明金鑰是受管管且有自動輪替 (Rotation) 設定的。
    * **SOP 文件**：提供內部的 "Key Management Policy" 文件，特別是關於「緊急撤銷程序」的章節（例如：當發生 Security Breach 時，誰有權限撤銷金鑰，以及如何通知終端設備更新信任清單）。

* **測試與驗證**：
    * **銷毀測試**：QA 執行 Factory Reset 後，嘗試透過 JTAG 或 Flash Dump 讀取原本的金鑰儲存區域，確認內容已變為 `0x00` 或 `0xFF`。

---
[回到 5.5 Communicate Securely](./5.5-communicate-securely.md)