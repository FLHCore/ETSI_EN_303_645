## 5.6 - 最小化暴露的攻擊面 (MINIMISE EXPOSED ATTACK SURFACES)

### 條款 5.6-2 (Provision 5.6-2)

在初始化狀態下，設備的網路介面必須最小化未經授權的安全相關資訊揭露 (unauthenticated disclosure of security-relevant information)。

#### 最低要求 (Minimum Requirements)

* 設備必須最小化未經授權的安全相關資訊揭露，以防威脅者利用這些資訊來入侵設備。
* 若在初始化狀態下有任何未經授權的安全相關資訊揭露，必須被視為是**設備功能所必需**和/或**認證所需**。

#### 佐證證據 (Supporting Evidence)

* 開發商應宣告在設備初始化狀態下（未認證）會揭露的所有安全相關資訊，並解釋這些資訊為何是設備功能所必需和/或認證所需。
* 開發商應提供佐證證據（例如：提交 nmap 報告、nmap 報告截圖等），透過執行以下指令來解釋所有已揭露的安全相關資訊：
    * `nmap -sT -sU -A -p- <ip address>`

#### 評估 (Assessment)

* 評估人員將檢查開發商針對設備在初始化狀態下揭露所有安全相關資訊所提供的解釋是否適當。
* 評估人員將檢查提供的證據，以解釋所有已揭露的安全資訊，並判斷設備上是否還有其他潛在的未經授權安全相關資訊揭露。

---

### 開發者深度導讀 (針對 Gateway / App / Cloud 開發商)

#### 本章節核心要求與意涵

本條款旨在防止**「資訊洩漏 (Information Leakage)」**，特別是透過 **Banner Grabbing** 獲取的資訊。

1.  **Banner 資訊的風險**：
    * 當駭客連線到 SSH 或 HTTP Port 時，服務器通常會回傳一個歡迎訊息 (Banner)。
    * **危險範例**：`SSH-2.0-OpenSSH_7.2p2 Ubuntu-4ubuntu2.10`。
    * 這串字告訴駭客：你用的是 OpenSSH 7.2，作業系統是 Ubuntu。駭客可以直接查 CVE 資料庫，找出 OpenSSH 7.2 的漏洞來打你。
2.  **合規目標**：
    * 並非完全不能有 Banner（這在技術上有時很難），而是要**「最小化」**。
    * **安全範例**：`SSH-2.0-OpenSSH`（隱藏版本號）或 `Server: WebServer`（隱藏 uhttpd/nginx 資訊）。

#### 具體落地實現方案建議

* **系統設計與設定調整**：
    * **SSH 設定 (`/etc/ssh/sshd_config`)**：
        * 加入 `DebianBanner no` (若適用)。
        * 雖然 SSH 協定強制要求回傳 Protocol Version，但應盡量減少 OS 資訊的後綴。
    * **Web Server 設定**：
        * **Nginx**：設定 `server_tokens off;`。
        * **Apache**：設定 `ServerTokens Prod` 和 `ServerSignature Off`。
    * **API 錯誤訊息**：
        * 當 API 發生錯誤 (500 Internal Server Error) 時，**絕對不能**回傳 Stack Trace 或詳細的 DB 錯誤訊息給前端。這會暴露程式路徑和資料庫結構。應只回傳通用的 "An error occurred"。

* **證據收集策略**：
    * **Nmap 深度掃描 (-A)**：
        * 此條款要求的 `-A` 參數會啟用 OS Detection 和 Version Detection。
        * **自我審查**：QA 需檢查 Nmap 輸出報告中的 "Service Info" 欄位。如果有出現具體的 `v1.2.3` 版本號，請開發修正。
    * **理由說明書**：
        * 對於無法隱藏的資訊（例如 mDNS/DNS-SD 廣播的設備名稱），必須在報告中解釋：「這是為了讓手機 App 能在區網中發現設備 (Service Discovery)，屬功能必要」。

* **測試與驗證**：
    * **Banner Grabbing 測試**：
        * 使用 `nc <IP> <Port>` (Netcat) 連線。
        * 例如 `nc 192.168.1.1 80`，然後輸入 `HEAD / HTTP/1.0` 接著按兩次 Enter。
        * 檢查回傳的 Header 中是否有 `Server: Linux/3.x UPnP/1.0 MiniUPnPd/1.6` 這類詳細資訊。