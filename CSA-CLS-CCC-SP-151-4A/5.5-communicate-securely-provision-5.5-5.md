## 5.5 – 安全通訊 (COMMUNICATE SECURELY)

### 條款 5.5-5 (Provision 5.5-5)

允許透過網路介面更改安全相關配置的設備功能，必須在身分驗證後方可存取 。
例外情況是設備依賴的網路服務協定，且製造商無法保證設備運作所需的配置為何 。

#### 最低要求 (Minimum Requirements)

* 在允許更改任何設備的安全相關資訊之前，必須對使用者進行**身分驗證** 。
* 這包括透過行動應用程式、GUI 甚至 CLI 進行的驗證 。
* (旨在無需驗證即可進行外部配置的網路服務協定 [例如：ARP, DHCP, DNS, ICMP, NTP 等] 是本條款的例外情況) 。

#### 佐證證據 (Supporting Evidence)

* 開發商應提供 **NMAP 掃描**結果，以顯示設備上所有開啟的連接埠及相關服務 。
    * 可使用以下指令：`nmap -sT -sU -A -p- <ip address>` 。
* 開發商應列出所有認證機制（例如：Telnet, FTP, SSH, 設備管理者入口網站, 行動應用程式, 藍牙等） 。
* 開發商應列出使用者能夠進行安全相關更改的所有管道，並提供證據（例如：截圖、驗證提示的影片等），證明僅在成功驗證後方可存取安全相關更改 。

#### 評估 (Assessment)

* 評估人員將檢查開發商提供的認證機制清單是否完整 。
* 評估人員將檢查 NMAP 掃描結果，以判斷開發商的認證機制清單是否準確 。
* 根據開發商提供的管道清單，評估人員將檢查安全相關更改是否僅在成功驗證後方可存取 。

---

### 開發者深度導讀 (針對 Gateway / App / Cloud 開發商)

#### 本章節核心要求與意涵

本條款旨在封堵**未授權配置更改 (Unauthenticated Configuration Changes)** 的漏洞。

1.  **API 安全是重災區**：
    * 許多開發者會保護 Web UI（如 `index.html` 會跳轉到 `login.html`），但卻忘記保護後端的 API（如 `/cgi-bin/set_wifi` 或 `/api/v1/update`）。
    * 攻擊者可以繞過前端 UI，直接發送 CURL 指令給 API。若 API 沒有檢查 Session Token 或 Cookie，就會違反此條款。
2.  **範圍涵蓋 CLI 與 App**：
    * 不只是 Web，透過 SSH/Telnet 進入後的 Command Line，或者手機 App 透過藍牙/Wi-Fi 發送的指令，全部都要有「先認證、後操作」的邏輯。
3.  **例外條款的合理使用**：
    * 像 DHCP (取得 IP)、ARP (解析 MAC) 這種基礎網路協定，天生就是免認證的，這不在限制範圍內。但如果是 UPnP（允許自動開 Port），則屬於高風險，通常建議預設關閉或限制範圍。

#### 具體落地實現方案建議

* **系統設計與後端邏輯**：
    * **全域中介軟體 (Global Middleware)**：
        * 在 Web Server (如 Go, Node.js, Python Flask) 中，設定一個 Global Auth Middleware。
        * 除了白名單路徑（如 `/login`, `/css/*`, `/js/*`, `/favicon.ico`）外，所有 Request 都必須檢查 `Authorization` Header 或 Cookie。
    * **CSRF Token**：
        * 雖然條款未明說，但防止 CSRF (跨站請求偽造) 是確保「變更請求確實來自已認證使用者」的最佳實務。建議在所有 POST/PUT 請求中強制檢查 CSRF Token。

* **證據收集策略**：
    * **操作錄影/截圖流程**：
        1.  **未登入狀態**：嘗試進入「Wi-Fi 設定頁面」或「修改密碼頁面」。
        2.  **預期結果**：系統彈出登入視窗，或直接轉導回登入頁（截圖 A）。
        3.  **已登入狀態**：輸入帳密後，成功進入設定頁面（截圖 B）。
    * **API 測試截圖**：
        * 使用 Postman 發送一個修改設定的 POST 請求（不帶 Token）。
        * 截取回傳的 `401 Unauthorized` 或 `403 Forbidden` 畫面。這比 UI 截圖更能證明 API 層級的安全性。

* **測試與驗證**：
    * **強制瀏覽 (Forced Browsing)**：
        * QA 在未登入情況下，直接在網址列輸入 `/admin/settings.html`，確認是否能繞過登入頁。
    * **CURL 攻擊測試**：
        * 嘗試用指令 `curl -X POST http://<IP>/api/set_password -d "new=123"`，確認在沒有 Session ID 的情況下是否會失敗。