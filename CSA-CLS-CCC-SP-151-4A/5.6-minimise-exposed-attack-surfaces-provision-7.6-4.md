## 5.6 - 最小化暴露的攻擊面 (MINIMISE EXPOSED ATTACK SURFACES)

### 條款 7.6-4 (Provision 7.6-4)

若支援訪客 Wi-Fi (guest Wi-Fi) 或社群 Wi-Fi (community Wi-Fi)，訪客或社群使用者必須無法存取僅供正常使用者使用的任何資產。

#### 最低要求 (Minimum Requirements)

* 訪客或社群使用者必須無法存取家庭閘道器 (HG) 的**配置入口網站 (configuration portal)**。
* 訪客或社群使用者必須無法與主 Wi-Fi 網路 (main Wi-Fi network) 中的使用者進行通訊。

#### 佐證證據 (Supporting Evidence)

* 開發商應提供證據（例如：截圖、影片等），證明訪客或社群使用者**無法存取** HG 的配置入口網站。
* 開發商應提供證據（例如：截圖、影片等），證明訪客或社群使用者**無法**與 HG 主網路中的設備進行通訊。
    * 展示此點的一個範例是：使用訪客或社群使用者的設備，嘗試 **Ping** 主網路中的設備。

#### 評估 (Assessment)

* 評估人員將檢查並確認訪客或社群使用者無法存取 HG 的配置入口網站。
* 評估人員將檢查並確認訪客或社群使用者無法與 HG 主網路中的設備進行通訊。

---

### 開發者深度導讀 (針對 Gateway / App / Cloud 開發商)

#### 本章節核心要求與意涵

本條款進一步具體化了 **Provision 5.6-1** 和 **7.6-3** 的隔離要求，重點在於**網路隔離 (Network Segmentation)** 的有效性驗證。

1.  **雙向阻隔**：
    * **Guest to LAN (Client Isolation)**：訪客不能連線到您家裡的 NAS、印表機或 Apple TV。這通常透過 VLAN 隔離或防火牆的 Forward Chain 阻擋來達成。
    * **Guest to Gateway (Management Plane Protection)**：這是最常失敗的點。許多路由器雖然擋了 Guest 連到 LAN，卻忘了擋 Guest 連到路由器本身的 IP (如 192.168.1.1) 的 Port 80/443。**合規要求明確指出：訪客絕對不能看到登入頁面**。

#### 具體落地實現方案建議

* **系統設計與防火牆規則 (iptables)**：
    * **介面定義**：假設主網路為 `br-lan`，訪客網路為 `br-guest`。
    * **禁止存取管理介面 (INPUT Chain)**：
        * 規則：`iptables -A INPUT -i br-guest -p tcp --dport 80 -j DROP`
        * 規則：`iptables -A INPUT -i br-guest -p tcp --dport 443 -j DROP`
        * 規則：`iptables -A INPUT -i br-guest -p tcp --dport 22 -j DROP` (SSH 也應阻擋)
        * **注意**：必須允許 DNS (Port 53) 與 DHCP (Port 67/68)，否則訪客無法上網。
    * **禁止存取內網 (FORWARD Chain)**：
        * 規則：`iptables -A FORWARD -i br-guest -o br-lan -j DROP`
        * 規則：`iptables -A FORWARD -i br-guest -d 192.168.1.0/24 -j DROP` (針對網段封鎖)

* **證據收集策略**：
    * **Ping 測試截圖**：
        * **場景**：訪客手機 (IP: 192.168.2.10) 嘗試 Ping 主網路電腦 (IP: 192.168.1.10)。
        * **截圖**：顯示 "Request Timed Out" 或 "Destination Host Unreachable"。
    * **瀏覽器存取測試截圖**：
        * **場景**：訪客手機嘗試瀏覽器開啟 `http://192.168.1.1` (Gateway IP)。
        * **截圖**：顯示 "無法連上網站" 或 "ERR_CONNECTION_REFUSED"，而非顯示登入畫面。

* **測試與驗證**：
    * **跨網段掃描**：
        * QA 連上訪客 Wi-Fi 後，使用 Fing 或 Nmap 掃描整個 LAN 網段。
        * **預期結果**：除了 Gateway IP (僅限 DNS/DHCP port) 外，不應發現任何其他設備。
    * **DNS Rebinding 防護**：雖然非此條款強制，但建議檢查是否能透過 DNS Rebinding 繞過防火牆存取內網，這是進階的攻擊測試。

---
[回到 5.6 Minimise Exposed Attack Surfaces](./5.6-minimise-exposed-attack-surfaces.md)