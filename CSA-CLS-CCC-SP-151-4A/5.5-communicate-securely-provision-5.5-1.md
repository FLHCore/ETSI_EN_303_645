## 5.5 – 安全通訊 (COMMUNICATE SECURELY)

### 條款 5.5-1 (Provision 5.5-1)

消費型物聯網設備必須使用最佳實務的密碼學技術來進行安全通訊 。

#### 最低要求 (Minimum Requirements)

* 設備與其他服務之間的通訊（傳輸通道）必須建立在 **TLS 1.2** 或更高版本之上，並搭配可接受的加密套件（參考 NIST SP 800-52）。
* 對於 Wi-Fi 路由器，必須實作 **WPA2** 或更高的通訊協定，同時符合 NIST SP 800-131A 的最佳密碼學加密演算法實務 。
* 對於藍牙通訊（包含 BLE），必須設定為 **Security Mode 1 with Security Level 3** 以上（排除 Security Mode 2 with Security Level 1）。
* 設備使用的 IoT 通訊協定不得為過時和/或易受攻擊的（例如：PnP, MQTT 等）。

#### 佐證證據 (Supporting Evidence)

* 開發商應列出設備與其他相關服務之間的所有通訊通道 。
    * 此類通訊的範例包括但不限於：
        * 設備到行動 App (companion app) 。
        * 設備到更新伺服器 。
        * 設備到電腦 (PC) 。
        * 藍牙連線 。
        * ZigBee 通訊協定的使用 。
* 開發商亦應提供證據（例如：截圖、影片、文件、白皮書等），顯示設備的通訊通道是安全的 。
* 對於 Wi-Fi 路由器，開發商應提供證據顯示設備預設已啟用 **WPA2** 或更高版本的通訊協定（例如：GUI 選項的截圖或影片、工具掃描器等）。

#### 評估 (Assessment)

* 評估人員將檢查宣告的通訊通道是否準確 。
* 評估人員將檢查開發商提供的證據，確保其適用於安全通訊 。
* 如適用，評估人員將檢查密碼學演算法是否符合 NIST SP 800-131A 。

---

### 開發者深度導讀 (針對 Gateway / App / Cloud 開發商)

#### 本章節核心要求與意涵

本條款針對所有對外介面的**傳輸層安全性**。

1.  **藍牙 (BLE) 的高標要求**：
    * 這是最容易被忽視的細節。條款明確要求 **Security Mode 1 Level 3** (Authenticated pairing with encryption)。
    * 這意味著不能使用簡單的 "Just Works" 配對（通常對應到 Level 1 或 2，無須密碼或僅未認證的加密）。開發者必須實作 **Passkey Entry** 或 **Numeric Comparison**（需要在設備或 App 端輸入/確認配對碼），這對無螢幕設備 (Headless Devices) 是 UX 設計上的一大挑戰。
2.  **IoT 協定的加密強制性**：
    * 條文中提到的 "MQTT" 易受攻擊，是指 **Plain MQTT (Port 1883)**。
    * **務必實作**：**MQTTS (Port 8883)**，即 MQTT over TLS。任何明文傳輸的 IoT 協定（如 CoAP, HTTP, Telnet）若無疊加 TLS/DTLS 層，皆屬違規。
3.  **Wi-Fi 路由器的 WPA2/WPA3**：
    * 雖然 WPA2 是最低標準，但建議預設啟用 **WPA2/WPA3 Mixed Mode** 或 **WPA3-SAE**。
    * 絕對禁止支援 WEP 或 WPA-TKIP（即使是為了相容性）。



#### 具體落地實現方案建議

* **系統設計與架構調整**：
    * **BLE Stack 設定**：
        * 檢查 Firmware 的 BLE Stack 設定（如 Nordic SoftDevice 或 ESP32 Bluedroid）。
        * 設定 `IO Capability` 不為 `NoInputNoOutput`（若硬體允許）。
        * 強制要求 `MITM` (Man-In-The-Middle) protection flag = True。
    * **MQTT Client 設定**：
        * 確保連線參數使用 `ssl://` 或 `mqtts://` 前綴。
        * 驗證 Server Certificate（防止中間人攻擊）。

* **證據收集策略**：
    * **Wireshark / Sniffer Log**：
        * **MQTT/HTTP**：提供封包截圖，證明是 TLS Encrypted Data。
        * **BLE**：使用 Frontline 或 Ellisys 藍牙分析儀（或 Wireshark 配合 nRF Sniffer）截取配對過程，證明有交換 `Pairing Request` 且 AuthReq 欄位包含 MITM/Bonding，隨後進入加密通訊。
    * **路由器 GUI 截圖**：
        * 截取 Wi-Fi 設定頁面，顯示 "Security Mode: WPA2-AES" 或 "WPA2-PSK (AES)"。

* **測試與驗證**：
    * **降級測試**：
        * 嘗試使用僅支援 WPA-TKIP 的舊網卡連線 Router，應連線失敗。

---
[回到 5.5 Communicate Securely](./5.5-communicate-securely.md)
