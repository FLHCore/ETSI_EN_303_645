## 5.3 – 保持軟體更新 (KEEP SOFTWARE UPDATED)

### 條款 5.3-1 (Provision 5.3-1)

* **a.** 若非所有軟體組件皆可更新，則受影響的組件必須被註記，並在使用者指引中標示。
* **b.** 家庭閘道器 (HG) 必須實作軟體版本控制，並在安裝前驗證更新提供的軟體版本是否有效。

#### 最低要求 (Minimum Requirements)

* 使用者指引/產品文件必須清楚標示**不可更新 (non-updateable)** 的軟體組件。
* 設備必須具備檢查功能，以確保更新提供的軟體版本號**高於**目前安裝的軟體版本號。

#### 佐證證據 (Supporting Evidence)

* 開發商應提供證據（例如：使用者指引文件、產品出版物等），列出設備所有的軟體組件，並在列表/表格中分類這些軟體組件是「可更新」還是「不可更新」。
    * 對於不可更新的軟體組件，開發商應提供理由，說明為何其不可更新。
    * 不可更新軟體組件的範例可能是儲存在唯讀記憶體 (ROM) 中的 Bootloader。
* 開發商應提供證據（例如：使用者指引文件、截圖、影片等）顯示軟體版本控制的實作。
    * 該證據必須展示驗證過程：確認更新提供的軟體版本號高於目前安裝的軟體版本號。

#### 評估 (Assessment)

* 評估人員將檢查開發商是否已清楚列出所有軟體組件，並標示其為可更新或不可更新。
* 評估人員將驗證並確認針對不可更新軟體組件所提供的理由是否充分。
* 評估人員將檢查設備是否實作了軟體版本控制，並在安裝前驗證更新提供的軟體版本是否有效。

---

### 開發者深度導讀 (針對 Gateway / App / Cloud 開發商)

#### 本章節核心要求與意涵

本條款確立了 OTA (Over-The-Air) 更新機制的兩大基石：**透明度 (Transparency)** 與 **防降級 (Anti-Rollback)**。

1.  **防止降級攻擊 (Anti-Rollback)**：這是安全性的關鍵。如果駭客發現新版韌體修復了漏洞，他們可能會誘騙使用者（或透過漏洞）將設備「降級」回舊版，以便利用舊漏洞進行攻擊。因此，系統必須強制檢查 `New_Version > Current_Version`。
2.  **組件透明化**：現代 IoT 設備通常包含多個層級（Bootloader, Kernel, Filesystem, Application, Radio Firmware）。如果某些部分寫死在 ROM 或 OTP (One-Time Programmable) 區域無法更新，必須在手冊中誠實告知，這屬於風險揭露的一部分。

#### 具體落地實現方案建議

* **系統設計與邏輯調整**：
    * **版本號比對邏輯**：
        * 在韌體標頭 (Header) 加入版本資訊。
        * 更新流程 (Update Process) 第一步：讀取 Header -> 解析版本 -> 比對當前版本。
        * 邏輯：`if (New_Ver <= Current_Ver) { Reject_Update(); Return Error; }`
        * **例外處理**：開發階段可能需要降級測試，建議設計一個「開發者模式」或特殊簽章的韌體才能繞過此檢查，但在 Production Build 必須強制開啟此檢查。
    * **軟體物料清單 (SBOM) 的初步整理**：雖然此處未強制要求完整 SBOM 格式，但開發團隊應整理一份內部清單，區分哪些是 Flash (可寫)、哪些是 ROM (唯讀)。

* **證據收集策略**：
    * **文件撰寫**：在 User Manual 的「規格」或「更新」章節，加註一行：「注意：本設備的 Bootloader 儲存於唯讀記憶體中，無法進行更新。」（若適用）。
    * **截圖準備**：
        * 刻意嘗試上傳一個「舊版韌體」。
        * 截取 GUI 彈出的錯誤訊息：「更新失敗：無法安裝舊版軟體 (v1.0)，目前版本為 (v2.0)」。這張圖是證明你有做版本檢查的最強證據。

* **測試與驗證**：
    * **同版本覆蓋測試**：上傳 v2.0 到已經是 v2.0 的機器，應被拒絕（或提示已是最新）。
    * **舊版本降級測試**：上傳 v1.0 到 v2.0 的機器，**必須**被拒絕。這是 QA 必測項目。

---
[回到 5.3 – 保持軟體更新 (KEEP SOFTWARE UPDATED)](./5.3-keep-software-updated.md)
