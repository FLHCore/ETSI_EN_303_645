## 5.4 – 安全地儲存敏感安全參數 (SECURELY STORE SENSITIVE SECURITY PARAMETERS)

### 條款 5.4-1 (Provision 5.4-1)

儲存在持久性儲存 (persistent storage) 中的敏感安全參數，必須由設備安全地儲存。

#### 最低要求 (Minimum Requirements)

* 儲存在持久性儲存中的敏感安全參數（例如：密碼、權杖 (tokens)、密鑰 (secret keys) 等），必須使用符合 **NIST SP 800-131A** 的密碼學演算法進行加密，或透過適當的安全儲存機制進行保護。

#### 佐證證據 (Supporting Evidence)

* 開發商應宣告設備是否儲存下列敏感參數：
    * 管理者密碼。
    * 用於客戶端認證的設備私鑰與公鑰。
    * 用於加密其他敏感參數的根金鑰 (Root Key)。
* 開發商應列出任何其他儲存在持久性儲存中，若被揭露/入侵可能影響設備安全性的敏感安全參數（例如：密碼、密鑰等）。
* 開發商應描述用於儲存前述宣告之敏感安全參數的安全機制。
    * 可接受的安全機制描述範例包括但不限於：
        * 若敏感參數使用金鑰加密，需描述加密金鑰是如何被儲存/衍生的。
        * 敏感參數儲存在**安全元件 (Secure Element)** 或**防竄改微控制器 (tamper protected microcontroller)** 中，而非外部快閃記憶體。
        * 使用**可信執行環境 (Trusted Execution Environment, TEE)** 來儲存與存取敏感參數。

#### 評估 (Assessment)

* 評估人員將檢查已宣告的敏感安全參數是否受到保護（即：使用安全儲存機制儲存、加密等）。

---

### 開發者深度導讀 (針對 Gateway / App / Cloud 開發商)

#### 本章節核心要求與意涵

本條款是物聯網設備防禦**實體攻擊**與**逆向工程**的最後一道防線。

1.  **禁止明文儲存 (No Plaintext)**：這是鐵律。不論是 Wi-Fi SSID 密碼、MQTT Broker 的連線密碼、還是設備身分憑證 (Private Key)，只要是寫入 Flash、EEPROM 或 SD 卡的資料，都必須是加密過的亂碼。
2.  **金鑰保護金鑰 (Key Wrapping)**：
    * 如果你用 AES 加密了使用者的 Wi-Fi 密碼，那這把 AES Key 放在哪？
    * 如果 AES Key 也明文存在 Flash 裡，那就只是「遮羞布」，不符合安全儲存定義。
    * **核心要求**：加密鏈的頂端（Root Key 或 Master Key）必須受到更高等級的保護（如硬體隔離或混淆）。

#### 具體落地實現方案建議

* **硬體層級方案（最佳實務）**：
    * **Secure Element (SE) / TPM**：將私鑰直接生成並鎖死在 SE 晶片內，外部 CPU 只能透過 I2C/SPI 發送「請幫我簽章」的指令，永遠無法讀出私鑰本身。
    * **TEE (TrustZone)**：利用 ARM TrustZone 將敏感運算隔離在 Secure World，金鑰只在 Secure RAM 中解密使用。

* **軟體層級方案（通用實作）**：
    * **檔案系統加密**：使用 Linux 的 `dm-crypt`, `LUKS`, 或 `fscrypt` 對 `/data` 分割區進行全碟或檔案級加密。
    * **金鑰衍生 (Key Derivation)**：不要硬編碼金鑰。利用設備獨有的硬體特徵（如 CPU Serial ID + eFuse Key）透過 KDF (Key Derivation Function) 在每次開機時動態計算出解密金鑰。
    * **Android Keystore (若適用)**：如果是 Android 系統，務必使用 Android Keystore System 來管理金鑰。

* **證據收集策略**：
    * **Hex Dump 佐證**：
        * 進到 Shell，執行 `hexdump -C /path/to/config.xml` 或 `cat /etc/shadow`。
        * 截圖證明相關欄位是亂碼（Encrypted Data）。
    * **架構描述圖**：
        * 畫一張 "Key Hierarchy" 圖。例如：`eFuse Root Key` -> `Filesystem Key` -> `User Data`。解釋金鑰是如何層層保護的。
    * **硬體規格書**：若使用 SE 晶片（如 ATECC608A），提供 Datasheet 並圈出 "Hardware Key Storage" 的功能描述。

* **測試與驗證**：
    * **離線掛載測試**：
        * QA 將 Flash 晶片解焊（或透過 JTAG/ISP 讀取），Dump 出完整的 Binary 映像檔。
        * 嘗試在 PC 上掛載該檔案系統或用文字編輯器搜尋敏感關鍵字（如 "password"）。
        * **合格標準**：搜尋不到任何有意義的明文，且無法掛載加密分割區。

---
[回到 5.4 Securely Store Sensitive Security Parameters](./5.4-securely-store-security-parameters.md)