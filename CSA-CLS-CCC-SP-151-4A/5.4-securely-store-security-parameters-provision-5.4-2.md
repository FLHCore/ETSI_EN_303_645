## 5.4 – 安全地儲存敏感安全參數 (SECURELY STORE SENSITIVE SECURITY PARAMETERS)

### 條款 5.4-2 (Provision 5.4-2)

若設備中使用硬編碼的「每台設備獨一無二 (unique per device)」身分識別作為安全用途，則其實作方式必須能抵抗透過實體、電氣或軟體等手段進行的篡改 (tampering)。

#### 最低要求 (Minimum Requirements)

* 設備中用於安全用途的任何硬編碼「每台設備獨一無二」識別碼，其實作方式必須能抵抗篡改。

#### 佐證證據 (Supporting Evidence)

* 開發商應宣告設備中是否使用了任何硬編碼的「每台設備獨一無二」識別碼。
* 開發商應描述這些已宣告的硬編碼「每台設備獨一無二」識別碼是如何實作以抵抗篡改的。
    * 範例包括：
        * 將硬編碼的每台設備獨一無二身分儲存在 **ROM** 中。
        * 將硬編碼的每台設備獨一無二身分燒錄至**一次性可程式化 (One-Time Programmable)** 硬體（例如：**eFuse** 等）中。
* 如適用，開發商應提供佐證證據（例如：照片、截圖、圖表等）。

#### 評估 (Assessment)

* 若設備使用了任何已宣告的硬編碼「每台設備獨一無二」識別碼，評估人員將檢查設備上實作的每一個硬編碼身分是否具備足夠的安全機制以抵抗篡改。

---

### 開發者深度導讀 (針對 Gateway / App / Cloud 開發商)

#### 本章節核心要求與意涵

本條款關注的是**設備身分鑑別 (Device Attestation)** 與 **防複製 (Anti-Cloning)**。

1.  **身分不可變性 (Immutability)**：
    * 設備的「身分證」（如 Serial Number, Device ID, MAC Address）如果只是寫在可讀寫的 Flash 檔案系統裡（例如 `/etc/config/system`），駭客只要取得 Root 權限就能隨意修改，甚至將一台合法設備的憑證複製到成千上萬台非法設備上（複製攻擊）。
    * 因此，合規要求這些 ID 必須「釘」在硬體上，軟體無法修改，甚至硬體手段（如電壓干擾）也難以篡改。
2.  **安全用途的定義**：
    * 如果這個 ID 只是用來顯示在 UI 上（無安全功能），則不在此限。但通常 Device ID 會被用來作為種子生成金鑰 (Key Derivation) 或作為雲端認證的身分，這就符合「安全用途」，必須受到保護。

#### 具體落地實現方案建議

* **硬體層級實作 (Hardware Implementation)**：
    * **eFuse (電子保險絲)**：這是 SoC 最常見的方案。在產線階段，將 Unique ID 寫入 eFuse 區域。eFuse 的物理特性決定了它一旦燒錄（熔斷）就無法恢復，從物理層面保證了「不可篡改」。
    * **Mask ROM / Boot ROM**：若 ID 是在晶片製造時就光罩寫死的（通常是 SoC 廠商提供的 Unique Chip ID），這也是符合要求的。
    * **PUF (Physical Unclonable Function)**：利用晶片製程的微小差異產生的獨特指紋，這是更高級的防護。

* **軟體與流程配合**：
    * **信任根綁定**：開機時，Bootloader 應讀取這個硬體 ID，並與存放在 Flash 中的憑證進行比對或驗證。若硬體 ID 與憑證不匹配（代表憑證是被複製過來的），則拒絕開機或連網。

* **證據收集策略**：
    * **晶片手冊 (Datasheet) 截圖**：提供 SoC 規格書中關於 "eFuse", "OTP Memory", 或 "Unique ID" 的章節，證明該硬體具備防寫功能。
    * **燒錄工具截圖**：提供產線使用的燒錄軟體畫面，顯示 "Burn eFuse" 或 "Program OTP" 的步驟。
    * **讀取測試**：在 Console 示範讀取該 ID 的指令（通常是特定的 `cat /sys/class/...` 或 `ioctl`），並示範嘗試寫入會失敗（例如回傳 "Read-only" 或 "Write Ignored"）。

* **測試與驗證**：
    * **軟體篡改測試**：QA 取得 Root 權限後，嘗試用 `dd` 或 `echo` 指令去覆蓋儲存 ID 的記憶體位址或驅動節點，確認數值不會改變。
    * **複製測試**：將 A 設備的 Flash 內容完整複製到 B 設備。B 設備開機後，讀取到的硬體 ID 仍應是 B 的（來自 eFuse），而非 A 的。這證明了 ID 是綁定硬體的。