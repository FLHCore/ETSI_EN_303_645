## 5.4 – 安全地儲存敏感安全參數 (SECURELY STORE SENSITIVE SECURITY PARAMETERS)

### 條款 7.4-1 (Provision 7.4-1)

存取 Wi-Fi® 與本地管理者憑證 (credentials) 的權限，必須限制僅能由家庭閘道器 (HG) 的已認證本地管理者存取。

#### 最低要求 (Minimum Requirements)

* 設備必須確保只有 HG 的**已認證本地管理者**有權存取 Wi-Fi® 與本地管理者憑證。

#### 佐證證據 (Supporting Evidence)

* 開發商應提供佐證證據（例如：截圖、產品文件等），顯示 Wi-Fi® 與本地管理者憑證的存取權限，已限制為僅供 HG 的已認證本地管理者存取。

#### 評估 (Assessment)

* 評估人員將檢查是否只有 HG 的已認證本地管理者有權存取 Wi-Fi® 與本地管理者憑證。

---

### 開發者深度導讀 (針對 Gateway / App / Cloud 開發商)

#### 本章節核心要求與意涵

本條款針對的是**水平權限隔離 (Horizontal Privilege Separation)** 與**敏感資料的存取控制 (Access Control)**。

1.  **防止越權存取 (IDOR 防護)**：
    * 許多家用路由器存在一個常見漏洞：訪客網路 (Guest Network) 的使用者，雖然無法登入管理介面，但卻可以透過未授權的 API (例如 `/api/get_wifi_password`) 抓取到主網路的 Wi-Fi 密碼。
    * 本條款明確禁止此類行為。只有「已登入」且身分為「管理者」的人，才能讀取或修改這些關鍵憑證。
2.  **角色定義 (Role Definition)**：
    * 如果您的系統支援多種角色（例如：Admin, User, Guest），必須嚴格定義誰能看什麼。
    * 普通 User 或 Guest 絕對不能有權限讀取 Admin 的密碼 hash 或主網路的 SSID 密碼。

#### 具體落地實現方案建議

* **系統設計與 API 權限控管**：
    * **Middleware 檢查**：
        * 在後端 API (如 Node.js Express, Go Gin, 或 C/C++ CGI) 的每一個敏感路由前，加入 `RequireAdminAuth()` 中介軟體。
        * 檢查 Session Token 是否有效 **AND** 角色是否為 Admin。
    * **顯示遮蔽 (Masking)**：
        * 即便對於管理者，在 UI 上顯示 Wi-Fi 密碼時，預設也應顯示為 `********`，並提供一個「顯示密碼」的按鈕（可能需要再次輸入 Admin 密碼確認），以防止背後窺視 (Shoulder Surfing)。

* **證據收集策略**：
    * **權限矩陣圖 (Permission Matrix)**：
        * 準備一張表格：
          | 功能 | Admin | Guest User | Unauthenticated |
          | :--- | :---: | :---: | :---: |
          | 檢視 Wi-Fi 密碼 | V | X | X |
          | 修改 Admin 密碼 | V | X | X |
    * **負面測試截圖**：
        * 截取當非管理員（或未登入狀態）嘗試存取敏感頁面或 API 時，系統回傳 **HTTP 403 Forbidden** 或 **401 Unauthorized** 的畫面。

* **測試與驗證**：
    * **直接物件參照攻擊 (IDOR) 測試**：
        * QA 使用 Postman 或 Burp Suite，在「未登入」狀態下直接呼叫 `/api/settings/wifi` 或類似的 Config 讀取接口，確認系統是否會洩漏 JSON 資料。
