## 5.5 – 安全通訊 (COMMUNICATE SECURELY)

### 條款 7.5-7 (Provision 7.5-7)

若使用防火牆，家庭閘道器 (HG) 實作的防火牆在出廠預設狀態下，不得包含任何**通訊埠轉發 (port forwarding)** 規則。

#### 最低要求 (Minimum Requirements)

* 在初始化時，Wi-Fi 路由器預設**不得包含任何通訊埠轉發規則**。

#### 佐證證據 (Supporting Evidence)

* 開發商應提供證據（例如：截圖、影片等），證明 Wi-Fi 路由器預設不包含任何通訊埠轉發規則。
* 證據應透過下列介面/管道展示：
    * 家庭閘道器的 Web GUI
    * 命令列介面 (CLI) 指令
        * 例如：`iptables -t nat -L -n`，這會顯示網路位址轉換 (NAT) 表。

#### 評估 (Assessment)

* 評估人員將檢查並確認 Wi-Fi 路由器預設不包含任何通訊埠轉發規則。

---

### 開發者深度導讀 (針對 Gateway / App / Cloud 開發商)

#### 本章節核心要求與意涵

本條款旨在防止**內網服務意外暴露**。

1.  **UPnP 的隱形風險**：
    * 通訊埠轉發 (Port Forwarding) 通常有兩種來源：
        * **靜態設定**：管理者手動設定「外部 Port 80 -> 內部 Camera IP Port 80」。
        * **動態協商 (UPnP/NAT-PMP)**：內網設備（如 NAS、遊戲機）自動跟路由器說「請幫我開門」。
    * **合規紅線**：雖然條款主要講「預設規則」，但實務上這也暗示 **UPnP (Universal Plug and Play)** 功能在出廠時最好是**關閉**的，或者是確保在沒有任何設備請求的情況下，NAT 表必須是乾淨的。
2.  **工廠預設值的潔淨**：
    * 有些 ISP 客製機為了遠端維運方便，可能會預設開一些特殊的 Forwarding 規則給機上盒 (STB) 或 VoIP 電話。除非有特殊理由並獲豁免，否則標準的 Internet Access VLAN 下，NAT 表必須是空的。

#### 具體落地實現方案建議

* **系統設計與預設值**：
    * **UPnP 開關**：在 Default Configuration 中，將 `upnpd` (如 `miniupnpd`) 設定為 `Disable`。這是確保沒有「隱形」轉發規則的最安全做法。
    * **NAT 表檢查**：確保 `/etc/config/firewall` (OpenWrt base) 中的 `config redirect` 區塊在出廠時是空的。

* **證據收集策略**：
    * **iptables NAT 表截圖**：
        * 這是最技術性的證據。
        * 指令：`iptables -t nat -L -n -v`
        * **關鍵檢查點**：查看 `Chain PREROUTING (policy ACCEPT)` 下面是否乾淨。如果有規則顯示 `DNAT to:192.168.x.x`，那就是違規。
    * **GUI 截圖**：
        * 進入「進階設定」->「NAT / Port Forwarding」或「虛擬伺服器 (Virtual Server)」頁面。
        * 截取列表為「空 (Empty)」的畫面。

* **測試與驗證**：
    * **UPnP 探測**：
        * QA 在 LAN 端使用 UPnP 測試工具（如 `upnpc -s`）查詢路由器狀態。
        * 確認路由器不會回報任何現存的 Mapping，或者直接拒絕 UPnP 請求（若預設關閉）。
    * **恢復原廠測試**：
        * 這是最容易出錯的地方。手動設定幾個 Forwarding 規則後，執行 Factory Reset。
        * 重開機後檢查 NAT 表是否已完全清空，確保沒有殘留設定。