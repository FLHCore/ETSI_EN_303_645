## 5.4 – 安全地儲存敏感安全參數 (SECURELY STORE SENSITIVE SECURITY PARAMETERS)

### 條款 5.4-3 (Provision 5.4-3)

設備軟體原始碼中不得使用硬編碼 (Hard-coded) 的關鍵安全參數 。

#### 最低要求 (Minimum Requirements)

* 設備軟體原始碼中不得包含硬編碼的關鍵安全參數 。
* 若設備軟體原始碼中嵌入了硬編碼的關鍵安全參數，設備的配置機制 (provisioning mechanism) 必須確保這些硬編碼的關鍵安全參數在設備的**運作階段 (operational phase)** 不再被使用 。

#### 佐證證據 (Supporting Evidence)

* 開發商應宣告設備原始碼中是否使用了任何硬編碼的關鍵安全參數 。
* 若設備軟體原始碼中嵌入了硬編碼的關鍵安全參數，開發商應提供證據，顯示這些硬編碼的關鍵安全參數在設備運作階段已不再被使用 。

#### 評估 (Assessment)

* 評估人員將檢查開發商是否宣告原始碼中含有任何硬編碼的關鍵安全參數 。
* 若有宣告，評估人員將檢查提供的證據，以確保硬編碼的關鍵安全參數在設備運作階段不再被使用 。

---

### 開發者深度導讀 (針對 Gateway / App / Cloud 開發商)

#### 本章節核心要求與意涵

本條款旨在消除最常見也最愚蠢的資安漏洞：**將密碼寫死在程式碼裡 (Hard-coded Credentials)**。

1.  **原始碼的潔淨**：
    * 開發者常為了方便測試，在 `config.h` 或 `constants.js` 中寫入 `const char* AWS_KEY = "AKIA..."` 或 `admin_password = "1234"`。
    * **風險**：一旦韌體被逆向工程 (Reverse Engineering) 或 Git Repo 洩漏，這些金鑰就會全球曝光。
2.  **例外情況 (Provisioning Exception)**：
    * 條款允許一種例外：**「工廠預設值」**。例如，程式碼裡可能有一組預設金鑰用於產線測試，但設備一旦出廠（進入 Operational Phase），這組金鑰必須被**停用**或被**覆蓋**，絕對不能在消費者手中還能運作。

#### 具體落地實現方案建議

* **系統設計與 CI/CD 流程**：
    * **環境變數注入 (Environment Variables)**：
        * 不要將金鑰 commit 進 Git。使用 `.env` 檔或 CI/CD Pipeline (如 Jenkins/GitHub Actions) 的 Secrets 功能，在編譯時 (Build Time) 才注入金鑰。
    * **工廠模式檢測 (Factory Mode Detection)**：
        * 如果程式碼中必須保留測試金鑰，必須加入邏輯：`if (PRODUCTION_MODE == true) { Disable_Test_Keys(); }`。
        * 確保 Production Build 的 Flag 是正確設定的。

* **證據收集策略**：
    * **靜態代碼分析 (SAST) 報告**：
        * 使用工具 (如 SonarQube, Trivy) 掃描原始碼，並截取報告顯示 "No Hardcoded Credentials Found"。
    * **字串搜尋 (Grep/Strings)**：
        * 對編譯好的 Firmware Binary 執行 `strings firmware.bin | grep -i "password"` 或搜尋已知的測試金鑰字串，證明它們不存在於最終產品中。

* **測試與驗證**：
    * **測試金鑰失效驗證**：
        * 假設程式碼中有一個測試用的 Root 密碼 "root123"。
        * QA 拿到市售版機器，嘗試用 "root123" 登入。
        * **預期結果**：登入失敗。這證明了「硬編碼參數在運作階段不再被使用」。