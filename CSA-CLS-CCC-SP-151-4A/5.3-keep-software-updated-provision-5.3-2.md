## 5.3 – 保持軟體更新 (KEEP SOFTWARE UPDATED)

### 條款 5.3-2 (Provision 5.3-2)

家庭閘道器 (HG) 必須具備用於安全安裝更新的更新機制。

#### 最低要求 (Minimum Requirements)

* 設備必須具備**防止降級策略 (anti-rollback policies)** 的更新機制，以防止使用者降級韌體（例如：安裝舊版設備韌體等）。
* 設備必須具備能防止使用者使用**被修改過的版本 (modified versions)** 韌體的更新機制。

#### 佐證證據 (Supporting Evidence)

* 開發商應列出設備所有的更新機制。這些更新機制的範例包括但不限於下列項目：
    * **自動更新**：設備從遠端伺服器下載並安裝更新。
    * **手動更新**：使用者需從開發商網站下載更新，並手動安裝到設備上。
    * 開發商提供的**電腦工具**：允許使用者使用 USB 隨身碟作為更新媒介。
    * **行動應用程式**：發送請求以便從遠端伺服器下載並安裝更新。
    * **網際網路服務供應商 (ISP)**：利用光纖寬頻將韌體更新推送到設備上等。
* 對於具有手動更新機制的設備，開發商應提供證據（例如：截圖、影片等），顯示設備能成功**拒絕**安裝「舊版」以及「被修改版」的韌體。

#### 評估 (Assessment)

* 評估人員將檢查開發商是否已宣告設備上所有的更新機制（例如：檢查設備是否有協助更新的配套應用程式等）。
* 若設備具有手動更新機制，評估人員將檢查設備是否能成功**拒絕**使用者安裝舊版和/或被修改版韌體的請求。

---

### 開發者深度導讀 (針對 Gateway / App / Cloud 開發商)

#### 本章節核心要求與意涵

本條款進一步強化了更新流程的安全性，重點在於**完整性 (Integrity)** 與 **版本控制的強制執行**。

1.  **完整性檢查 (Anti-Modification)**：
    * 這是為了防止「客製化韌體」或「被植入後門的韌體」被寫入設備。
    * 僅檢查檔案大小或 CRC32 是不夠的，必須使用**數位簽章 (Digital Signature)**。
2.  **防降級 (Anti-Rollback)**：
    * 與 5.3-1 相呼應，但這裡強調的是「機制 (Mechanism)」與「策略 (Policy)」。這意味著防降級檢查必須是在韌體寫入 Flash **之前**發生的強制性檢查。

#### 具體落地實現方案建議

* **系統設計與邏輯調整**：
    * **簽章驗證流程 (Signature Verification)**：
        * 韌體打包時：使用開發商的私鑰 (Private Key) 對韌體進行簽章 (Sign)。
        * 韌體更新時：設備使用預埋的公鑰 (Public Key, 參見 7.3-1) 驗證簽章。
        * 邏輯：`if (Verify_Signature(Firmware) == FAIL) { Drop_Update(); Return Error; }`
    * **防止修改測試**：
        * 即便是更改韌體中的一個 Byte（例如修改 UI 字串），也會破壞簽章的完整性，設備必須拒收。

* **證據收集策略**：
    * **列出所有更新途徑**：PM 需梳理產品有多少種更新方式。常見遺漏：忘記列出 "Recovery Mode" 或 "Factory Tool" 的更新途徑。若這些途徑存在且未做安全檢查，會成為合規漏洞。
    * **「拒絕更新」的實證**：
        * **情境一（防降級）**：嘗試刷入舊版，截取錯誤訊息（例如 "Update Failed: Version too old"）。
        * **情境二（防竄改）**：使用 Hex Editor 隨意修改合法韌體的一個 Byte，嘗試刷入，截取錯誤訊息（例如 "Update Failed: Signature Verification Error" 或 "Invalid Firmware"）。**這張截圖非常關鍵**。

* **測試與驗證**：
    * **Fuzz Testing (輕量級)**：QA 隨機產生一個垃圾檔案 (dummy file) 並更名為 `firmware.bin`，嘗試透過 GUI 上傳，確認系統不會當機且能正確拒絕。
    * **篡改測試**：QA 修改正確韌體的 Header 或 Payload 部分，確認更新機制能偵測並阻擋。

---
[回到 5.3 – 保持軟體更新 (KEEP SOFTWARE UPDATED)](./5.3-keep-software-updated.md)
