## 5.6 - 最小化暴露的攻擊面 (MINIMISE EXPOSED ATTACK SURFACES)

### 條款 5.6-5 (Provision 5.6-5)

製造商必須僅啟用設備預期用途或運作所使用或需要的軟體服務。

#### 最低要求 (Minimum Requirements)

* 設備必須預設僅啟用必要且核心的軟體服務。
* 路由器必須預設**停用**下列軟體服務（在 **LAN 與 WAN** 介面上）：
    * **WPS** (Wi-Fi Protected Setup)
    * **HNAP** (Home Network Administration Protocol)
    * **SSH**
* 路由器必須預設**停用**下列軟體服務（在 **WAN** 介面上）：
    * **NAT-PMP** (NAT Port Mapping Protocol)
    * **PCP** (Port Control Protocol)
    * **Remote Administration** (遠端管理)
    * **SNMP** (Simple Network Management Protocol)
    * **Telnet**
    * **UPnP** (Universal Plug and Play)

#### 佐證證據 (Supporting Evidence)

* 開發商應針對 WAN 與 LAN 介面執行通訊埠掃描（請參考下列 nmap 指令），並提供證據（例如：截圖、附上 nmap 輸出檔等）顯示完整報告，確保所有連接埠皆已列入考量。
    * 通訊埠掃描可使用以下指令執行：`nmap -sT -sU -A -p- <ip address>`
* 開發商應針對預設啟用的非核心軟體服務提供正當理由 (Justification)。

#### 評估 (Assessment)

* 評估人員將檢查開發商提供的軟體服務清單是否完整。
* 評估人員將檢查通訊埠掃描的輸出結果，以判斷是否有任何對路由器運作非必要的軟體服務被啟用。

---

### 開發者深度導讀 (針對 Gateway / App / Cloud 開發商)

#### 本章節核心要求與意涵

本條款是 **Service Hardening (服務強化)** 的具體清單，直接點名了「黑名單」服務。

1.  **WPS 的強制關閉**：
    * 雖然 WPS 對使用者很方便（按按鈕就連線），但其 PIN 碼機制存在已知的暴力破解漏洞 (Pixie Dust Attack 等)。此規範要求**預設關閉**。這意味著 OOBE (開箱即用) 狀態下，使用者按 WPS 按鈕應該是沒反應的，必須先進 GUI 啟用。
2.  **LAN 端 SSH 的禁令**：
    * 請注意，規範要求 **SSH 在 LAN 端也要預設關閉**。
    * 這對習慣保留 SSH 給進階使用者 (Power User) 的開發者來說是一個陷阱。您必須在出廠時關閉 `dropbear` 或 `sshd`，並在 GUI 提供一個「啟用 SSH」的開關（最好伴隨警告訊息）。
3.  **HNAP 與舊協定的清理**：
    * HNAP 是早期 D-Link 等廠商使用的管理協定，漏洞極多。如果您的程式碼庫是繼承自舊專案，請務必檢查是否殘留了 `hnapd` 相關程式碼並將其移除。

#### 具體落地實現方案建議

* **系統設計與編譯選項**：
    * **OpenWrt/Linux 編譯設定**：
        * 移除不必要的套件：`miniupnpd` (或預設 disable), `snmpd`, `telnetd`。
        * **Hostapd (Wi-Fi)**：設定 `wps_state=0` (Disabled) 在預設的 `wireless` config 中。
    * **防火牆與服務管理**：
        * 確保 WAN Interface 的 Input Filter 丟棄所有 TCP/UDP 封包（除了 DHCP client 回應）。
        * 檢查 `/etc/init.d/`，確保 `sshd` 的啟動腳本 (S50sshd) 預設是 `disabled` 狀態。

* **證據收集策略**：
    * **Nmap 雙重掃描**：
        * **Scan 1 (LAN Side)**：接上 LAN Port 掃描。確認 Port 22 (SSH), 23 (Telnet), 5357 (WSD/LLTD) 的狀態。
        * **Scan 2 (WAN Side)**：接上 WAN Port 掃描。確認 Port 80, 443, 1900 (UPnP), 5351 (NAT-PMP) 的狀態。
        * **合格標準**：黑名單中的服務必須顯示 `Closed` 或 `Filtered`。
    * **GUI 設定截圖**：
        * 截取 Wi-Fi 設定頁面，顯示 "WPS: Disabled"。
        * 截取 UPnP 設定頁面，顯示 "UPnP: Disabled"。

* **測試與驗證**：
    * **WPS 按鈕測試**：
        * 恢復原廠設定後，按下機身 WPS 按鈕。
        * 使用手機觀察 Wi-Fi 訊號，確認**沒有**進入 WPS 配對模式（通常會有 PBC 標記）。
    * **SNMP 探測**：
        * 使用 `snmpwalk -v 2c -c public <IP>` 嘗試讀取資訊。
        * **預期結果**：Timeout 或 Connection Refused。