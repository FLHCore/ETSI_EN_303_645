## 5.1 – 禁用通用預設密碼 (NO UNIVERSAL DEFAULT PASSWORDS)

### 條款 5.1-5 (Provision 5.1-5)

家庭閘道器 (HG) 必須具備一種機制，使得透過網路介面針對認證機制的暴力破解攻擊 (brute-force attacks) 在實務上不可行 (impracticable)。

#### 最低要求 (Minimum Requirements)

* 每一個認證介面（例如：設備管理入口網站、行動應用程式登入、SSH 等）都必須採用**暴力破解防護措施**。
    * 典型的暴力破解防護措施範例包括但不限於：
        * **速率限制策略 (Rate limiting policies)**：限制在一段時間內的認證次數（例如：達到門檻後強制鎖定/延遲等）。
        * **多因子認證 (MFA)**：在初始設定後啟用。
        * **一次性密碼 (OTPs)**。
* 對於採用速率限制策略作為暴力破解防護措施的設備：
    * 若實作方式是「達到門檻後強制執行延遲」，則必須確保透過暴力破解攻擊入侵**至少需要 100 天**。
    * 若實作方式是「透過 IP 封鎖 (IP blocking) 進行速率限制」，則暴力破解攻擊成功的機率必須**低於 1%**。

#### 佐證證據 (Supporting Evidence)

* 開發商應描述設備認證機制上實作的暴力破解防護措施。
* 對於非速率限制策略的防護措施（如 OTP），開發商應提供其有效期限的截圖證據（例如：設備介面/行動應用程式/電子郵件上的訊息截圖，顯示 OTP 有效期多久）。
* 對於速率限制策略，開發商應宣告在給定時間內的最大嘗試次數（門檻）（或每個 IP 位址的嘗試次數），以及達到最大嘗試次數後的結果（例如：解釋什麼被鎖定/延遲）。
* 接著，開發商應提供證據（例如：影片、截圖等）顯示速率限制策略生效的情況。
    * 可接受的範例包括但不限於：
        * 顯示已達最大登入嘗試次數的錯誤訊息。
        * 顯示鎖定期間 (locked-out period) 的錯誤訊息。
* 最後，開發商應使用下列公式進行計算，以證明所採用的速率限制策略符合最低要求（如上所述）：
    * **計算密碼破解所需天數**：
      $$\text{所需天數} = \frac{\text{密碼字元池}^{(\text{密碼長度})}}{\text{24小時內的嘗試次數} \times 2}$$
    * **對於 IP 封鎖應用，計算暴力破解攻擊成功的機率**：
      $$\text{暴力破解成功機率 \%} = \left( \frac{\text{IP位址總數} \times \text{每個IP位址的嘗試次數}}{\text{密碼字元池}^{(\text{密碼長度})}} \right) \times 100\%$$

#### 評估 (Assessment)

* 評估人員將檢查提供的計算結果，確保設備採用的速率限制策略足以保護設備免受暴力破解攻擊，意即符合「至少需要 100 天才能入侵」或「暴力破解成功機率低於 1%」的標準。
* 評估人員將檢查在認證失敗時向使用者顯示的錯誤訊息，是否提供了關於暴力破解緩解措施（速率限制策略、IP 封鎖等）的充分資訊。

---

### 開發者深度導讀 (針對 Gateway / App / Cloud 開發商)

#### 本章節核心要求與意涵

本條款的核心在於**「增加攻擊者的時間成本」**。單純的「密碼錯誤提示」是不夠的，系統必須主動介入阻斷連續的錯誤嘗試。

1.  **數學證明的強制性**：這是此條款最特別的地方。您不能只說「我有做鎖定」，必須用數學公式證明您的鎖定策略夠強，強到駭客需要花 100 天才能猜出密碼。
2.  **使用者體驗與安全性的平衡**：
    * 如果鎖定太嚴格（例如錯 3 次鎖 1 小時），正常使用者忘記密碼時會非常挫折。
    * 如果鎖定太寬鬆（例如錯 100 次才鎖 1 分鐘），則無法通過上述的數學公式檢驗。
3.  **錯誤訊息的資訊揭露**：評估標準要求錯誤訊息需提供「充分資訊」（例如：「您已嘗試太多次，請等待 5 分鐘後再試」）。這有助於使用者理解狀況，但也需注意不要過度揭露帳號是否存在（User Enumeration），建議使用通用的「帳號或密碼錯誤」配合「暫時無法登入」的狀態提示。

#### 具體落地實現方案建議

* **系統設計與參數調整**：
    * **指數退避 (Exponential Backoff)**：這是推薦的作法。
        * 第 1-3 次失敗：無延遲。
        * 第 4 次失敗：延遲 30 秒。
        * 第 5 次失敗：延遲 1 分鐘。
        * 第 6 次失敗：延遲 5 分鐘...以此類推。
    * **如何通過「100 天」計算？**
        * 假設密碼長度由 5.1-1 規定為 **10 碼**。
        * 假設字元池 (Character Pool) 為 **62** (A-Z, a-z, 0-9)。
        * 分子 (密碼空間) = $62^{10}$ (這是一個天文數字)。
        * 分母 (每天嘗試次數) = 即使您允許駭客每天試 10,000 次，算出來的天數也遠遠超過 100 天。
        * **關鍵結論**：只要您落實了 **5.1-1 (10 碼密碼)** 並且有**基本的速率限制**（例如每分鐘只能試 5 次），這個數學公式幾乎一定會通過。重點在於**密碼長度**與**字元池**的定義要正確引用。

* **證據收集策略**：
    * **計算表 (Calculation Sheet)**：準備一份 Excel 或 PDF，將您的參數（密碼長度、字元池大小、鎖定機制允許的每日最大嘗試次數）代入公式，算出結果（例如：需要 500 年），以此證明 > 100 天。
    * **觸發鎖定畫面**：
        * QA 需手動或寫腳本連續輸入錯誤密碼，直到介面出現 "Too many attempts, please try again in X minutes" 的畫面，並截圖。
    * **App 與 Web 都要測**：如果 App 使用 API 登入，API 回傳的錯誤碼 (如 HTTP 429 Too Many Requests) 與 Response Body 也需要截圖或 Log 佐證。

* **測試與驗證**：
    * **自動化腳本**：使用 Hydra 或 Burp Suite Intruder 對登入接口進行攻擊測試，確認在達到 N 次後，系統是否真的拒絕回應或回傳鎖定訊息。

---
[回到 5.1 No Universal Default Passwords ](./5.1-no-universal-default-passwords-provision-5.1-1.md)
